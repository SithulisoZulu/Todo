---
import { app } from "../../firebase/server";
import { getFirestore } from "firebase-admin/firestore";
import TodoLayout from "../../layouts/TodoLayout.astro";

interface Task {
  task: string;
  date: Date;

}

const { id } = Astro.params;

if (!id) {
  return Astro.redirect("/404");
}

const db = getFirestore(app);
const tasksRef = db.collection("tasks");
const taskSnapshot = await tasksRef.doc(id).get();

if (!taskSnapshot.exists) {
  return Astro.redirect("/404");
}

const task = taskSnapshot.data() as Task;

---

<TodoLayout title={task.task}>

  <form method="post" action={`../api/tasks/${id}`}>

    <input type="text" id="name" name="name" value={task.task} />
    <label for="age">Age</label>
   
    <label for="isBesttask">Is best task?</label>

    <button type="submit">Edit task</button>
  </form>
  <button class="bg-rose-500" type="button" id="delete-document">Delete</button>
</TodoLayout>
<script>
  const deleteButton = document.getElementById(
    "delete-document"
  ) as HTMLButtonElement;
  const url = document.querySelector("form")?.getAttribute("action") as string;
  deleteButton.addEventListener("click", async () => {
    const response = await fetch(url, {
      method: "DELETE",
    });
    if (response.redirected) {
      window.location.assign(response.url);
    }
  });
</script>